#!/usr/bin/env bash
set -eo pipefail

indent() {
  sed -u 's/^/       /'
}

FFMPEG_VERSION="2.6.3"

echo "-----> Install ffmpeg $FFMPEG_VERSION"

BUILD_DIR="$1"
VENDOR_PATH="$BUILD_DIR/vendor"

PROFILE_PATH="$BUILD_DIR/.profile.d"
INSTALL_PATH="$VENDOR_PATH/ffmpeg"

DOWNLOAD_URL="http://johnvansickle.com/ffmpeg/releases/ffmpeg-$FFMPEG_VERSION-64bit-static.tar.xz"

echo "DOWNLOAD_URL = " $DOWNLOAD_URL | indent

mkdir -p "$INSTALL_PATH"
cd "$INSTALL_PATH"

curl -L --silent $DOWNLOAD_URL | tar xJ --strip-components=1

mkdir -p "$PROFILE_PATH"
echo 'export PATH="$PATH:$INSTALL_PATH"' >> "$PROFILE_PATH/ffmpeg.sh"
